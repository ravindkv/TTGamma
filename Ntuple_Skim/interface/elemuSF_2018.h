           #include<TH2F.h>
//only muon is updated here 01_03_2019


//Taken from combining BCDEF and GH from https://twiki.cern.ch/twiki/bin/view/CMS/MuonWorkInProgressAndPagResults
double mu2018TrackingSF[6][4][3]={{{0.9889516659404209, 0.992114065208379, 0.995276464476337}, {0.9830413987810256, 0.9880778949699621, 0.9931143911588987}, {0.9916018098622307, 0.9922334188037855, 0.9928650277453402}, {0.9767110348482012, 0.9797230542389544, 0.9827350736297077}},
            {{0.9913464548564839, 0.9924247027728448, 0.9935029506892057}, {0.9840813173929762, 0.9858269794946017, 0.9875726415962273}, {0.9899139978076039, 0.9923174786068355, 0.9947209594060671}, {0.9752582101439433, 0.9781500508836776, 0.9810418916234118}},
            {{0.9915156099945539, 0.9922515732194475, 0.992987536444341}, {0.9827150853822233, 0.9861662092005419, 0.9896173330188605}, {0.9908729567661959, 0.9922065831090526, 0.9935402094519094}, {0.9768894944578763, 0.9777848757048854, 0.9786802569518944}},
            {{0.9923178864933132, 0.9926712022753303, 0.9930245180573475}, {0.986579658299012, 0.9868886396371438, 0.9871976209752756}, {0.9915536875457643, 0.9915977902632379, 0.9916418929807115}, {0.9759259247061014, 0.9777795367016231, 0.9796331486971448}},
            {{0.9924236700360682, 0.9928603953286465, 0.9932971206212247}, {0.9847941498763463, 0.9857803031481773, 0.9867664564200084}, {0.9916324047430506, 0.9925127625404958, 0.993393120337941}, {0.9745733677398587, 0.9770080438205287, 0.9794427199011988}},
            {{0.9898609671041078, 0.992263125763373, 0.9946652844226384}, {0.9832044369459287, 0.9851298296096568, 0.9870552222733848}, {0.9906520589122124, 0.9910195523946569, 0.9913870458771014}, {0.9694287582541636, 0.9739992676455306, 0.978569777036897}}};

double mu2018IdIsoSF[6][4][3]={{{0.9869341603944494, 0.9878176955285117, 0.9887012306625741}, {0.9850577479970761, 0.9862650274736514, 0.9874723069502267}, {1.0280877140844062, 1.028706924507017, 1.0293261349296279}, {1.0636014288917264, 1.0646215698389723, 1.0656417107862182}},
{{0.988554509486599, 0.9888813192028745, 0.98920812891915}, {0.9904452434717524, 0.9910231456738477, 0.991601047875943}, {1.0193318977493384, 1.019912800520605, 1.0204937032918717}, {1.042737605549706, 1.0432519540478973, 1.0437663025460886}},
{{0.9933366962948182, 0.9935666916527235, 0.9937966870106287}, {0.9934698066222156, 0.9937724398120359, 0.9940750730018562}, {1.0097810894197765, 1.0102498978210022, 1.0107187062222278}, {1.0245175166517722, 1.0249591620167777, 1.0254008073817833}},
{{0.9965350820622605, 0.9966412317599858, 0.996747381457711}, {0.9965932756094662, 0.9967368461214523, 0.9968804166334384}, {1.0051307756501944, 1.0051965386437043, 1.0052623016372142}, {1.0122092118781087, 1.0124054226957773, 1.0126016335134458}},
{{0.9971808744434991, 0.9972883904897889, 0.9973959065360787}, {0.9973103306755029, 0.9974497957928933, 0.9975892609102837}, {1.0027733080843613, 1.0029043016742643, 1.0030352952641672}, {1.0067964800869065, 1.007179827421075, 1.0075631747552436}},
{{0.9984608908839363, 0.9986074741139223, 0.9987540573439082}, {0.9991752350202571, 0.9994679987569142, 0.9997607624935713}, {1.0019480161310155, 1.0020165183989265, 1.0020850206668375}, {1.004790038428336, 1.0058322938718882, 1.0068745493154405}}};

//Taken from https://twiki.cern.ch/twiki/bin/view/CMS/MuonReferenceEffs2018
double mu2018TrigSF[8][4][3]={{{0.9331952376804661, 0.9342767596244812, 0.9353582815684963}, {0.9294687253882057, 0.9314934015274048, 0.9335180776666039}, {0.9158958387079864, 0.9175182580947876, 0.9191406774815888}, {0.8324520675954684, 0.8396418690681458, 0.8468316705408231}},
{{0.9199490759912237, 0.9225825071334839, 0.9252159382757441}, {0.9008899111032467, 0.9060879945755005, 0.9112860780477543}, {0.9038886913247111, 0.9074284434318542, 0.9109681955389974}, {0.814471844479147, 0.8290793299674988, 0.8436868154558506}},
{{0.8978712002700698, 0.8981866836547852, 0.8985021670395005}, {0.8656582430860799, 0.8664416074752808, 0.8672249718644817}, {0.8513911061011594, 0.8518872261047363, 0.8523833461083132}, {0.7085559064641832, 0.7096239328384399, 0.7106919592126967}},
{{0.9229120267439632, 0.9230125546455383, 0.9231130825471134}, {0.9148044701348146, 0.9150134921073914, 0.9152225140799681}, {0.885067147082803, 0.8852240443229675, 0.8853809415631321}, {0.7776128102795232, 0.7780017256736755, 0.7783906410678278}},
{{0.8904270305150151, 0.8973246216773987, 0.9042222128397822}, {0.8758599603938397, 0.8884395360946655, 0.9010191117954913}, {0.8984458487620445, 0.9069849252700806, 0.9155240017781167}, {0.769627394443036, 0.8021486401557922, 0.8346698858685485}},
{{0.9354159390767594, 0.9354934692382812, 0.9355709993998031}, {0.9352842233378813, 0.9354234337806702, 0.935562644223459}, {0.9075359774732847, 0.9076412916183472, 0.9077466057634096}, {0.8173582609375631, 0.8176633715629578, 0.8179684821883524}},
{{0.9388687109124769, 0.9390319585800171, 0.9391952062475573}, {0.9408642650155032, 0.9411582946777344, 0.9414523243399655}, {0.9140753253559109, 0.9143072366714478, 0.9145391479869847}, {0.8288626939783131, 0.8295277953147888, 0.8301928966512645}},
{{0.9400687759904324, 0.9404017329216003, 0.9407346898527683}, {0.9416790761989821, 0.9421609044075012, 0.9426427326160204}, {0.9191552127433561, 0.9195489883422852, 0.9199427639412142}, {0.8379301835257322, 0.8392589688301086, 0.84058775413448}}};



//https://twiki.cern.ch/twiki/bin/view/CMS/EgammaIDRecipesRun2#Instructions_for_applying_electr
/*double eleTrigSF[10][6][3]={ { {1.,1.,1.},{1.,1.,1.},{1.,1.,1.},{1.,1.,1.},{1.,1.,1.},{1.,1.,1.}, },
							 { {1.,1.,1.},{1.,1.,1.},{1.,1.,1.},{1.,1.,1.},{1.,1.,1.},{1.,1.,1.}, },
							 { {1.,1.,1.},{1.,1.,1.},{1.,1.,1.},{1.,1.,1.},{1.,1.,1.},{1.,1.,1.}, },
							 { {1.,1.,1.},{1.,1.,1.},{1.,1.,1.},{1.,1.,1.},{1.,1.,1.},{1.,1.,1.}, },
							 { {1.,1.,1.},{1.,1.,1.},{1.,1.,1.},{1.,1.,1.},{1.,1.,1.},{1.,1.,1.}, },
							 { {1.,1.,1.},{1.,1.,1.},{1.,1.,1.},{1.,1.,1.},{1.,1.,1.},{1.,1.,1.}, },
							 { {1.,1.,1.},{1.,1.,1.},{1.,1.,1.},{1.,1.,1.},{1.,1.,1.},{1.,1.,1.}, },
							 { {1.,1.,1.},{1.,1.,1.},{1.,1.,1.},{1.,1.,1.},{1.,1.,1.},{1.,1.,1.}, },
							 { {1.,1.,1.},{1.,1.,1.},{1.,1.,1.},{1.,1.,1.},{1.,1.,1.},{1.,1.,1.}, },
							 { {1.,1.,1.},{1.,1.,1.},{1.,1.,1.},{1.,1.,1.},{1.,1.,1.},{1.,1.,1.}, }, };

*/
double ele2018RecoSF[12][5][3]={{{1.00492,1.01998,1.03503},{0.985098,0.986556,0.988014},{0.986231,0.98768,0.989129},{0.990701,1.00206,1.01341},{0.97173,0.983673,0.995617}},
{{0.965569,0.983351,1.00113},{0.985187,0.986639,0.988092},{0.98732,0.988764,0.990208},{1.00772,1.01837,1.02901},{0.989285,0.997967,1.00665}},
{{1.19304,1.25678,1.32051},{0.983496,0.986095,0.988694},{0.964411,0.967672,0.970934},{1.01427,1.04381,1.07335},{1.0082,1.03668,1.06516}},
{{1.00952,1.0307,1.05188},{0.986054,0.987526,0.988998},{0.988231,0.989691,0.99115},{1.0013,1.00818,1.01506},{1.0003,1.00718,1.01406}},
{{0.964064,0.971215,0.978367},{0.990312,0.99177,0.993227},{0.988326,0.989775,0.991224},{1.00289,1.00815,1.01342},{1.00155,1.0061,1.01065}},
{{0.953957,0.974973,0.995988},{0.988218,0.98968,0.991142},{0.988302,0.989754,0.991206},{0.998482,1.00305,1.00763},{0.998507,1.00304,1.00758}},
{{0.953957,0.974973,0.995988},{0.995433,0.996894,0.998356},{0.995462,0.996914,0.998366},{1.01699,1.02156,1.02613},{0.998507,1.00304,1.00758}},
{{0.964064,0.971215,0.978367},{0.997511,0.998968,1.00043},{0.996498,0.997947,0.999396},{1.01443,1.01947,1.0245},{1.00155,1.0061,1.01065}},
{{1.00952,1.0307,1.05188},{0.986028,0.9875,0.988972},{0.98821,0.989669,0.991129},{1.0034,1.01028,1.01715},{1.0003,1.00718,1.01406}},
{{1.19304,1.25678,1.32051},{0.970595,0.973193,0.975792},{0.976924,0.980392,0.983861},{1.00676,1.03533,1.0639},{1.0082,1.03668,1.06516}},
{{0.965569,0.983351,1.00113},{0.986227,0.98768,0.989132},{0.989373,0.990816,0.99226},{1.00051,1.01018,1.01985},{0.989285,0.997967,1.00665}},
{{1.00492,1.01998,1.03503},{0.982098,0.983556,0.985014},{0.986281,0.98773,0.989179},{0.995918,1.00716,1.01841},{0.97173,0.983673,0.995617}}};

double ele2018IDSF[10][6][3]={{{1.15748,1.20359,1.24971},{1.12987,1.16262,1.19536},{1.07399,1.09199,1.10999},{1.03703,1.06369,1.09034},{0.99652,1.02774,1.05897},{0.88411,0.965594,1.04708}},
{{0.974398,1.02208,1.06975},{0.9759,1.0062,1.0365},{1.0065,1.01048,1.01447},{0.992436,1,1.00756},{0.985465,1.00459,1.02372},{0.963298,1.01562,1.06795}},
{{0,1,2},{0,1,2},{0,1,2},{0,1,2},{0,1,2},{0,1,2}},
{{0.95266,0.99449,1.03632},{0.920831,0.945017,0.969203},{0.946023,0.951923,0.957824},{0.948848,0.955527,0.962207},{0.935487,0.964203,0.99292},{0.905927,0.949944,0.993962}},
{{0.94726,0.97136,0.995461},{0.928995,0.945652,0.962309},{0.948968,0.952258,0.955548},{0.941482,0.952955,0.964429},{0.940354,0.956473,0.972592},{0.994615,1.0262,1.05778}},
{{0.997586,1.02169,1.04579},{0.943033,0.95969,0.976347},{0.95542,0.95871,0.961999},{0.947414,0.958888,0.970361},{0.969007,0.985126,1.00124},{0.935237,0.963636,0.992036}},
{{0.958062,1,1.04194},{0.928611,0.952797,0.976983},{0.952433,0.958333,0.964234},{0.957238,0.963918,0.970597},{0.967596,0.996424,1.02525},{0.943663,0.987627,1.03159}},
{{0,1,2},{0,1,2},{0,1,2},{0,1,2},{0,1,2},{0,1,2}},
{{0.941309,0.988987,1.03666},{0.98074,1.01104,1.04134},{0.994708,0.998691,1.00267},{0.997202,1.00493,1.01266},{0.975152,0.994279,1.01341},{0.91828,0.967126,1.01597}},
{{1.22218,1.26829,1.31441},{1.10904,1.14179,1.17454},{1.06695,1.08495,1.10295},{1.01073,1.03738,1.06404},{0.977368,1.00835,1.03934},{0.97765,1.05959,1.14154},}};
double get2018MuSF(double pt, double eta, int systLevel){

	double abseta = abs(eta);

	//binned in 0.2 in absEta
	//int muTrackEtaRegion = int(abseta/0.2);

	int muEtaRegion = -1;
	if (abseta < 0.9) {muEtaRegion = 0;}
	else if (abseta < 1.2) {muEtaRegion = 1;}
	else if (abseta < 2.1) {muEtaRegion = 2;}
	else {muEtaRegion = 3;}

	int muPtRegion_Trigger = -1;
	if (pt < 30){muPtRegion_Trigger = 0;}
	else if (pt < 40){muPtRegion_Trigger = 1;}
	else if (pt < 50){muPtRegion_Trigger = 2;}
	else if (pt < 60){muPtRegion_Trigger = 3;}
	else if (pt < 120){muPtRegion_Trigger = 4;}
	else if (pt < 200){muPtRegion_Trigger = 5;}
	else if (pt < 300){muPtRegion_Trigger = 6;}
	else {muPtRegion_Trigger = 7;}

	int muPtRegion_IDIso = -1;
      	if (pt < 25){muPtRegion_IDIso = 0;}
	else if (pt < 30){muPtRegion_IDIso = 1;}
	else if (pt < 40){muPtRegion_IDIso = 2;}
	else if (pt < 50){muPtRegion_IDIso = 3;}
	else if (pt < 60){muPtRegion_IDIso = 4;}
	else {muPtRegion_IDIso = 5;}

        double syst_var[3][3]={ {0.99,0.995,0.995},{1.,1.,1.},{1.01,1.005,1.005}};
	double muEffSF=-1;
	
	//muEffSF = muTrackingSF[muTrackEtaRegion][systLevel] *syst_var[systLevel][0]* muIdIsoSF[muPtRegion_IDIso][muEtaRegion][systLevel]* syst_var[systLevel][1]* muTrigSF[muPtRegion_Trigger][muEtaRegion][systLevel]*syst_var[systLevel][2];
	muEffSF = mu2018TrackingSF[muPtRegion_IDIso][muEtaRegion][systLevel] *syst_var[systLevel][0]* mu2018IdIsoSF[muPtRegion_IDIso][muEtaRegion][systLevel]* syst_var[systLevel][1]* mu2018TrigSF[muPtRegion_Trigger][muEtaRegion][systLevel]*syst_var[systLevel][2];
	return muEffSF;

}


double get2018EleSF(double pt, double eta, int systLevel){

	int eleRecoEtaRegion = 0;
	int eleIDEtaRegion = 0;

	/*if (eta > -2.45 ){eleRecoEtaRegion++;}
	if (eta > -2.4	){eleRecoEtaRegion++;}
	if (eta > -2.3	){eleRecoEtaRegion++;}
	if (eta > -2.2	){eleRecoEtaRegion++;}
	if (eta > -2.0	){eleRecoEtaRegion++; eleIDEtaRegion++;}
	if (eta > -1.8	){eleRecoEtaRegion++;}
	if (eta > -1.63	){eleRecoEtaRegion++;}
	if (eta > -1.566){eleRecoEtaRegion++; eleIDEtaRegion++;}
	if (eta > -1.444){eleRecoEtaRegion++; eleIDEtaRegion++;}
	if (eta > -1.2	){eleRecoEtaRegion++;}
	if (eta > -1.0	){eleRecoEtaRegion++;}
	if (eta > -0.8	){eleIDEtaRegion++;}
	if (eta > -0.6	){eleRecoEtaRegion++;}
	if (eta > -0.4	){eleRecoEtaRegion++;}
	if (eta > -0.2	){eleRecoEtaRegion++;}
	if (eta > 0.0	){eleRecoEtaRegion++; eleIDEtaRegion++;}
	if (eta > 0.2	){eleRecoEtaRegion++;}
	if (eta > 0.4	){eleRecoEtaRegion++;}
	if (eta > 0.6	){eleRecoEtaRegion++;}
	if (eta > 0.8	){eleIDEtaRegion++;}
	if (eta > 1.0	){eleRecoEtaRegion++;}
	if (eta > 1.2	){eleRecoEtaRegion++;}
	if (eta > 1.444	){eleRecoEtaRegion++; eleIDEtaRegion++;}
	if (eta > 1.566	){eleRecoEtaRegion++; eleIDEtaRegion++;}
	if (eta > 1.63	){eleRecoEtaRegion++;}
	if (eta > 1.8	){eleRecoEtaRegion++;}
	if (eta > 2.0	){eleRecoEtaRegion++; eleIDEtaRegion++;}
	if (eta > 2.2	){eleRecoEtaRegion++;}
	if (eta > 2.3	){eleRecoEtaRegion++;}
	if (eta > 2.4	){eleRecoEtaRegion++;}
	if (eta > 2.45	){eleRecoEtaRegion++;}*/
	
//	if (eta < -2.0	){eleRecoEtaRegion++;  eleIDEtaRegion++;}
	if (eta > -2.0 ){eleRecoEtaRegion++;   eleIDEtaRegion++;}
	if (eta > -1.566){eleRecoEtaRegion++;  eleIDEtaRegion++;}
	if (eta > -1.444 ){eleRecoEtaRegion++; eleIDEtaRegion++;}
	if (eta > -0.8 ){                       eleIDEtaRegion++; }
	if (eta > -1.0 ){eleRecoEtaRegion++; }
	if (eta > -0.5 ){eleRecoEtaRegion++; }
	if (eta > 0.0 ){eleRecoEtaRegion++;    eleIDEtaRegion++;}
	if (eta > 0.5 ){eleRecoEtaRegion++; }
	if (eta > 1.0 ){eleRecoEtaRegion++; }
	if (eta > 0.8 ){                       eleIDEtaRegion++; }
	if (eta > 1.444	){eleRecoEtaRegion++;  eleIDEtaRegion++;}
	if (eta > 1.566	){eleRecoEtaRegion++;  eleIDEtaRegion++;}
	if (eta > 2.0	){eleRecoEtaRegion++;  eleIDEtaRegion++;}

	int eleIDPtRegion = 0;

//	if (pt > 10.0  ){eleIDPtRegion++;}
	if (pt > 20.0  ){eleIDPtRegion++;}
	if (pt > 35.0  ){eleIDPtRegion++;}
	if (pt > 50.0  ){eleIDPtRegion++;}
	if (pt > 100.0  ){eleIDPtRegion++;}
	if (pt > 200.0 ){eleIDPtRegion++;}
	
	int eleRecoPtRegion = 0;
//	if (pt > 20.0 ){eleRecoPtRegion++;}
	if (pt > 45.0  ){eleRecoPtRegion++;}
	if (pt > 75.0  ){eleRecoPtRegion++;}
	if (pt > 100.0  ){eleRecoPtRegion++;}

//	int eleTrigEtaRegion = eleIDEtaRegion;
//	int eleTrigPtRegion  = eleIDPtRegion;

	double eleEffSF = ele2018IDSF[eleIDEtaRegion][eleIDPtRegion][systLevel] * ele2018RecoSF[eleRecoEtaRegion][eleRecoPtRegion][systLevel];
	//double eleEffSF = eleTrigSF[eleTrigEtaRegion][eleTrigPtRegion][systLevel] * eleIDSF[eleIDEtaRegion][eleIDPtRegion][systLevel] * eleRecoSF[eleRecoEtaRegion][systLevel];
	//double eleEffSF = eleTrigSF[eleTrigEtaRegion][eleTrigPtRegion][systLevel] * eleIDSF[systLevel] * eleRecoSF[systLevel];
	return eleEffSF;


}

